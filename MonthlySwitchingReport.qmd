---
title: "Switching Tracking Study"
echo: false
format: 
  html:
    toc: false
    toc-depth: 3
    toc-title: Report Sections
    number-sections: true
    theme: cosmo
    fontsize: 0.9em
    mainfont: Arial
    page-layout: full
    df-print: paged
---


```{r}
#| label: Load Packages
#| include: false
library(tidyverse)
library(systemfonts)
library(lubridate)
library(scales)

```


```{r}
#| label: Load Dataset and Set Reporting Attributes
#| include: false

rawSwitchingData <- read_csv("Switching.csv")
reportMonth <- '2023-1'

```


```{r}
#| label: Create cleaned and expanded Dataset
#| include: false


# Remove test data line
switchingData <- rawSwitchingData %>%
  filter(Participant !=1)

# Add Dates, month, year and report period fields

switchingData <- switchingData %>%
  mutate(responseDateTime = dmy_hm(End), responseMonth = month(responseDateTime), responseYear = year(responseDateTime)) %>%
  unite("reportPeriod", c(responseYear,responseMonth),sep = "-") %>%
  mutate(responseMonth = month(responseDateTime), responseYear = year(responseDateTime)) %>%
  mutate(responseMonth2Digit = case_when(nchar(responseMonth) == 1 ~ str_c(0,responseMonth), nchar(responseMonth) == 2 ~ str_c(responseMonth))) %>%
  mutate(reportSummaryDate = ymd(str_c(responseYear , responseMonth2Digit ,"01"))) %>%
  mutate(reportPeriod = fct_reorder(reportPeriod,reportSummaryDate))

# Convert chr fields into numeric

switchingData <- switchingData %>%
  mutate_at(vars(Q2.1:Q2.11), list(as.numeric)) %>%
  mutate_at(vars(Q4), list(as.numeric)) %>%
  mutate_at(vars(Q7.1:Q9.5), list(as.numeric)) %>%
  mutate_at(vars(Q11), list(as.numeric)) %>%
  mutate_at(vars(Q14.1:Q16.5), list(as.numeric)) %>%
  mutate_at(vars(Q19:Q21), list(as.numeric))

# Add changing loyalty descriptors

switchingData <- switchingData %>%
  mutate(loyaltyChange = case_when (Q1 == 1 ~"I made my first transaction with Gopuff in the last month.",
                                    Q1 == 2 ~"I ordered from Gopuff in the last month, after having previously not shopped with Gopuff for a while.",
                                    Q1 == 3 ~"I regularly shop with Gopuff, and ordered more than usual in the last month.",
                                    Q1 == 4 ~"I regularly shop with Gopuff, and ordered about the same in the last month when compared to previous months.",
                                    Q1 == 5 ~"I regularly shop with Gopuff, but ordered less than usual in the last month. ",
                                    Q1 == 6 ~"I did not purchase from Gopuff last month.",
                                    Q1 == 7 ~"I donâ€™t recall how much I spent with Gopuff last month."))  %>%
  mutate(loyaltyChange = fct_reorder(loyaltyChange, Q1))

# Switching to Gopuff -> where did you shop less

switchingData <- switchingData %>%
  mutate(shopLess = case_when (Q4 == 1 ~"Aldi",
                              Q4 == 2 ~"Asda",
                              Q4 == 3 ~"Co-op",
                              Q4 == 4 ~"Getir",
                              Q4 == 5 ~"Gorillas",
                              Q4 == 6 ~"Iceland",
                              Q4 == 7 ~"Lidl",
                              Q4 == 8 ~"Local Convenience Store",
                              Q4 == 9 ~"Marks and Spencer",
                              Q4 == 10 ~"Morrisons",
                              Q4 == 11 ~"A Main Sainsbury's",
                              Q4 == 12 ~"Sainsbury's Local",
                              Q4 == 13 ~"A Main Tesco",
                              Q4 == 14 ~"Tesco Express",
                              Q4 == 15 ~"Ocado",
                              Q4 == 16 ~"Waitrose",
                              Q4 == 17 ~"Zapp",
                              Q4 == 18 ~"Deliveroo",
                              Q4 == 19 ~"Uber Eats",
                              Q4 == 20 ~"Just Eat",
                              Q4 == 21 ~"Other"))

# Switching to Gopuff -> Which orders do you expect to place

## Day to Day Grocery

switchingData <- switchingData %>%
  mutate(switchToGrocery = case_when (Q9.1 == 1 ~"Highly likely to place an order",
                                     Q9.1 == 2 ~"Somewhat likely to place an order",
                                     Q9.1 == 3 ~"Unlikely to place an order",
                                     Q9.1 == 4 ~"Will definitely not place an order"
                             ))

## Drinks

switchingData <- switchingData %>%
  mutate(switchToDrinks = case_when (Q9.2 == 1 ~"Highly likely to place an order",
                                     Q9.2 == 2 ~"Somewhat likely to place an order",
                                     Q9.2 == 3 ~"Unlikely to place an order",
                                     Q9.2 == 4 ~"Will definitely not place an order"
                             ))

## Snacks

switchingData <- switchingData %>%
  mutate(switchToSnacks = case_when (Q9.3 == 1 ~"Highly likely to place an order",
                                     Q9.3 == 2 ~"Somewhat likely to place an order",
                                     Q9.3 == 3 ~"Unlikely to place an order",
                                     Q9.3 == 4 ~"Will definitely not place an order"
                             ))

## Tobacco/Vapes

switchingData <- switchingData %>%
  mutate(switchToSmoking = case_when (Q9.4 == 1 ~"Highly likely to place an order",
                                     Q9.4 == 2 ~"Somewhat likely to place an order",
                                     Q9.4 == 3 ~"Unlikely to place an order",
                                     Q9.4 == 4 ~"Will definitely not place an order"
                             ))

## Urgent Needs

switchingData <- switchingData %>%
  mutate(switchToUrgent = case_when (Q9.5 == 1 ~"Highly likely to place an order",
                                     Q9.5 == 2 ~"Somewhat likely to place an order",
                                     Q9.5 == 3 ~"Unlikely to place an order",
                                     Q9.5 == 4 ~"Will definitely not place an order"
                             ))

# Switching away from Gopuff -> where did you shop more

switchingData <- switchingData %>%
  mutate(shopMore = case_when (Q11 == 1 ~"Aldi",
                              Q11 == 2 ~"Asda",
                              Q11 == 3 ~"Co-op",
                              Q11 == 4 ~"Getir",
                              Q11 == 5 ~"Gorillas",
                              Q11 == 6 ~"Iceland",
                              Q11 == 7 ~"Lidl",
                              Q11 == 8 ~"Local Convenience Store",
                              Q11 == 9 ~"Marks and Spencer",
                              Q11 == 10 ~"Morrisons",
                              Q11 == 11 ~"A Main Sainsbury's",
                              Q11 == 12 ~"Sainsbury's Local",
                              Q11 == 13 ~"A Main Tesco",
                              Q11 == 14 ~"Tesco Express",
                              Q11 == 15 ~"Ocado",
                              Q11 == 16 ~"Waitrose",
                              Q11 == 17 ~"Zapp",
                              Q11 == 18 ~"Deliveroo",
                              Q11 == 19 ~"Uber Eats",
                              Q11 == 20 ~"Just Eat",
                              Q11 == 21 ~"Other"))

# Switching away from Gopuff -> Which orders do you expect to place

## Day to Day Grocery

switchingData <- switchingData %>%
  mutate(switchAwayGrocery = case_when (Q16.1 == 1 ~"Highly likely to place an order",
                                     Q16.1 == 2 ~"Somewhat likely to place an order",
                                     Q16.1 == 3 ~"Unlikely to place an order",
                                     Q16.1 == 4 ~"Will definitely not place an order"
                             ))

## Drinks

switchingData <- switchingData %>%
  mutate(switchAwayDrinks = case_when (Q16.2 == 1 ~"Highly likely to place an order",
                                     Q16.2 == 2 ~"Somewhat likely to place an order",
                                     Q16.2 == 3 ~"Unlikely to place an order",
                                     Q16.2 == 4 ~"Will definitely not place an order"
                             ))

## Snacks

switchingData <- switchingData %>%
  mutate(switchAwaySnacks = case_when (Q16.3 == 1 ~"Highly likely to place an order",
                                     Q16.3 == 2 ~"Somewhat likely to place an order",
                                     Q16.3 == 3 ~"Unlikely to place an order",
                                     Q16.3 == 4 ~"Will definitely not place an order"
                             ))

## Tobacco/Vapes

switchingData <- switchingData %>%
  mutate(switchAwaySmoking = case_when (Q16.4 == 1 ~"Highly likely to place an order",
                                     Q16.4 == 2 ~"Somewhat likely to place an order",
                                     Q16.4 == 3 ~"Unlikely to place an order",
                                     Q16.4 == 4 ~"Will definitely not place an order"
                             ))

## Urgent Needs

switchingData <- switchingData %>%
  mutate(switchAwayUrgent = case_when (Q16.5 == 1 ~"Highly likely to place an order",
                                     Q16.5 == 2 ~"Somewhat likely to place an order",
                                     Q16.5 == 3 ~"Unlikely to place an order",
                                     Q16.5 == 4 ~"Will definitely not place an order"
                            ))

## Customer Profile Questions

switchingData <- switchingData %>%
  mutate(AgeGroup = case_when(Q19 == 1 ~ "16-21",
                         Q19 == 2 ~ "22-24",
                         Q19 == 3 ~ "25-29",
                         Q19 == 4 ~ "30-34",
                         Q19 == 5 ~ "35-44",
                         Q19 == 6 ~ "45-54",
                         Q19 == 7 ~ "55-64",
                         Q19 == 8 ~ "65-74",
                         Q19 == 9 ~ "75+",
                         Q19 == 10 ~ "Prefer not to Say"))

switchingData <- switchingData %>%
  mutate(OccupationGroup = case_when(Q21 == 1 ~ "Full Time Employed",
                         Q21 == 2 ~ "Part Time Employed",
                         Q21 == 3 ~ "Self Employed",
                         Q21 == 4 ~ "Unemployed",
                         Q21 == 5 ~ "Student",
                         Q21 == 6 ~ "Pensioner",
                         Q21 == 7 ~ "Prefer not to Say"
                         )) %>%
  mutate(OccupationGroup = fct_reorder(OccupationGroup, Q21))

switchingData <- switchingData %>%
  mutate(EthnicGroup = case_when(Q20 == 1 ~ "White - English / Welsh / Scottish / Northern Irish / British",
                                 Q20 == 2 ~ "White - Irish",
                                 Q20 == 3 ~ "White - Gypsy or Irish Traveller",
                                 Q20 == 4 ~ "White - Any other",
                                 Q20 == 5 ~ "Mixed / Multiple ethnic groups - White and Black Caribbean",
                                 Q20 == 6 ~ "Mixed / Multiple ethnic groups - White and Black African",
                                 Q20 == 7 ~ "Mixed / Multiple ethnic groups - White and Asian",
                                 Q20 == 8 ~ "Mixed / Multiple ethnic groups - Any other",
                                 Q20 == 9 ~ "Asian / Asian British - Indian",
                                 Q20 == 10 ~ "Asian / Asian British - Pakistani",
                                 Q20 == 11 ~ "Asian / Asian British - Bangladeshi",
                                 Q20 == 12 ~ "Asian / Asian British - Chinese",
                                 Q20 == 13 ~ "Asian / Asian British - Any other Asian background",
                                 Q20 == 14 ~ "Black / African / Caribbean / Black British - African",
                                 Q20 == 15 ~ "Black / African / Caribbean / Black British - Caribbean",
                                 Q20 == 16 ~ "Black / African / Caribbean / Black British - Any other",
                                 Q20 == 17 ~ "Other Ethnic Group - Arab",
                                 Q20 == 18 ~ "Other Ethnic Group - Any other",
                                 Q20 == 19 ~ "Prefer not to say"
                         
                                 ))

```


# SWITCHING DATA

Include data like:
- How many customers did we start the month with on the database
- How many customers did we end the month with on the database
- Showing the net movement.

- Then say how many new customers, reactivated, increased loyalty etc etc
- Could also include some profiling of key attributes as well
- But mainly data from the loyalty dash
- And could possibly link off to that in the report.


```{r}
#| label: Number Responses

# Count how many responses.

completedResponses <-switchingData %>%
  filter(reportPeriod == reportMonth) %>%
  summarise(n=n())

completedResponsesValue <- completedResponses[[1]]

```

# RESEARCH RESPONSES

In the latest month of data collection we had `r completedResponsesValue` completed responses.

The share of customer self-evaluated changing loyalty levels in the latest month are as follows:

```{r}
#| label: Loyalty Change

switchingData %>%
  filter(reportPeriod == reportMonth) %>%
  group_by(loyaltyChange) %>%
  summarise(n=n()) %>%
  mutate(freq = round(n/sum(n),3)) %>%
  mutate(perc = percent(freq,accuracy = 0.1)) %>%
  select(-freq)

```


## CUSTOMERS INCREASING THEIR LOYALTY TO GOPUFF

### Awareness

For customers that made their first transaction with Gopuff in the last month, where did they originially hear about Gopuff?



In the latest month of data collection we had `r completedResponsesValue` completed responses.
<br>
<br>


