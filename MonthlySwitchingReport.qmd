---
title: "Switching Tracking Study"
echo: false
format: 
  html:
    toc: false
    toc-depth: 3
    toc-title: Report Sections
    number-sections: true
    theme: cosmo
    fontsize: 0.9em
    mainfont: Arial
    page-layout: full
    df-print: paged
---


```{r}
#| label: Load Packages
#| include: false
library(tidyverse)
library(systemfonts)
library(lubridate)
library(scales)

```


```{r}
#| label: Load Dataset and Set Reporting Attributes
#| include: false

rawSwitchingData <- read_csv("Switching.csv")
reportMonth <- '2023-1'

```


```{r}
#| label: Create cleaned and expanded Dataset
#| include: false


# Remove test data line
switchingData <- rawSwitchingData %>%
  filter(Participant !=1)

# Add Dates, month, year and report period fields

switchingData <- switchingData %>%
  mutate(responseDateTime = dmy_hm(End), responseMonth = month(responseDateTime), responseYear = year(responseDateTime)) %>%
  unite("reportPeriod", c(responseYear,responseMonth),sep = "-") %>%
  mutate(responseMonth = month(responseDateTime), responseYear = year(responseDateTime)) %>%
  mutate(responseMonth2Digit = case_when(nchar(responseMonth) == 1 ~ str_c(0,responseMonth), nchar(responseMonth) == 2 ~ str_c(responseMonth))) %>%
  mutate(reportSummaryDate = ymd(str_c(responseYear , responseMonth2Digit ,"01"))) %>%
  mutate(reportPeriod = fct_reorder(reportPeriod,reportSummaryDate))

# Convert chr fields into numeric

switchingData <- switchingData %>%
  mutate_at(vars(Q2.1:Q2.11), list(as.numeric)) %>%
  mutate_at(vars(Q4), list(as.numeric)) %>%
  mutate_at(vars(Q7.1:Q9.5), list(as.numeric)) %>%
  mutate_at(vars(Q11), list(as.numeric)) %>%
  mutate_at(vars(Q14.1:Q16.5), list(as.numeric)) %>%
  mutate_at(vars(Q19:Q21), list(as.numeric))

# Add changing loyalty descriptors

switchingData <- switchingData %>%
  mutate(loyaltyChange = case_when (Q1 == 1 ~"I made my first transaction with Gopuff in the last month.",
                                    Q1 == 2 ~"I ordered from Gopuff in the last month, after having previously not shopped with Gopuff for a while.",
                                    Q1 == 3 ~"I regularly shop with Gopuff, and ordered more than usual in the last month.",
                                    Q1 == 4 ~"I regularly shop with Gopuff, and ordered about the same in the last month when compared to previous months.",
                                    Q1 == 5 ~"I regularly shop with Gopuff, but ordered less than usual in the last month. ",
                                    Q1 == 6 ~"I did not purchase from Gopuff last month.",
                                    Q1 == 7 ~"I don’t recall how much I spent with Gopuff last month."))  %>%
  mutate(loyaltyChange = fct_reorder(loyaltyChange, Q1))

# Switching to Gopuff -> where did you shop less

switchingData <- switchingData %>%
  mutate(shopLess = case_when (Q4 == 1 ~"Aldi",
                              Q4 == 2 ~"Asda",
                              Q4 == 3 ~"Co-op",
                              Q4 == 4 ~"Getir",
                              Q4 == 5 ~"Gorillas",
                              Q4 == 6 ~"Iceland",
                              Q4 == 7 ~"Lidl",
                              Q4 == 8 ~"Local Convenience Store",
                              Q4 == 9 ~"Marks and Spencer",
                              Q4 == 10 ~"Morrisons",
                              Q4 == 11 ~"A Main Sainsbury's",
                              Q4 == 12 ~"Sainsbury's Local",
                              Q4 == 13 ~"A Main Tesco",
                              Q4 == 14 ~"Tesco Express",
                              Q4 == 15 ~"Ocado",
                              Q4 == 16 ~"Waitrose",
                              Q4 == 17 ~"Zapp",
                              Q4 == 18 ~"Deliveroo",
                              Q4 == 19 ~"Uber Eats",
                              Q4 == 20 ~"Just Eat",
                              Q4 == 21 ~"Other"))

# Switching to Gopuff -> Which orders do you expect to place

## Day to Day Grocery

switchingData <- switchingData %>%
  mutate(switchToGrocery = case_when (Q9.1 == 1 ~"Highly likely to place an order",
                                     Q9.1 == 2 ~"Somewhat likely to place an order",
                                     Q9.1 == 3 ~"Unlikely to place an order",
                                     Q9.1 == 4 ~"Will definitely not place an order"
                             ))

## Drinks

switchingData <- switchingData %>%
  mutate(switchToDrinks = case_when (Q9.2 == 1 ~"Highly likely to place an order",
                                     Q9.2 == 2 ~"Somewhat likely to place an order",
                                     Q9.2 == 3 ~"Unlikely to place an order",
                                     Q9.2 == 4 ~"Will definitely not place an order"
                             ))

## Snacks

switchingData <- switchingData %>%
  mutate(switchToSnacks = case_when (Q9.3 == 1 ~"Highly likely to place an order",
                                     Q9.3 == 2 ~"Somewhat likely to place an order",
                                     Q9.3 == 3 ~"Unlikely to place an order",
                                     Q9.3 == 4 ~"Will definitely not place an order"
                             ))

## Tobacco/Vapes

switchingData <- switchingData %>%
  mutate(switchToSmoking = case_when (Q9.4 == 1 ~"Highly likely to place an order",
                                     Q9.4 == 2 ~"Somewhat likely to place an order",
                                     Q9.4 == 3 ~"Unlikely to place an order",
                                     Q9.4 == 4 ~"Will definitely not place an order"
                             ))

## Urgent Needs

switchingData <- switchingData %>%
  mutate(switchToUrgent = case_when (Q9.5 == 1 ~"Highly likely to place an order",
                                     Q9.5 == 2 ~"Somewhat likely to place an order",
                                     Q9.5 == 3 ~"Unlikely to place an order",
                                     Q9.5 == 4 ~"Will definitely not place an order"
                             ))

# Switching away from Gopuff -> where did you shop more

switchingData <- switchingData %>%
  mutate(shopMore = case_when (Q11 == 1 ~"Aldi",
                              Q11 == 2 ~"Asda",
                              Q11 == 3 ~"Co-op",
                              Q11 == 4 ~"Getir",
                              Q11 == 5 ~"Gorillas",
                              Q11 == 6 ~"Iceland",
                              Q11 == 7 ~"Lidl",
                              Q11 == 8 ~"Local Convenience Store",
                              Q11 == 9 ~"Marks and Spencer",
                              Q11 == 10 ~"Morrisons",
                              Q11 == 11 ~"A Main Sainsbury's",
                              Q11 == 12 ~"Sainsbury's Local",
                              Q11 == 13 ~"A Main Tesco",
                              Q11 == 14 ~"Tesco Express",
                              Q11 == 15 ~"Ocado",
                              Q11 == 16 ~"Waitrose",
                              Q11 == 17 ~"Zapp",
                              Q11 == 18 ~"Deliveroo",
                              Q11 == 19 ~"Uber Eats",
                              Q11 == 20 ~"Just Eat",
                              Q11 == 21 ~"Other"))

# Switching away from Gopuff -> Which orders do you expect to place

## Day to Day Grocery

switchingData <- switchingData %>%
  mutate(switchAwayGrocery = case_when (Q16.1 == 1 ~"Highly likely to place an order",
                                     Q16.1 == 2 ~"Somewhat likely to place an order",
                                     Q16.1 == 3 ~"Unlikely to place an order",
                                     Q16.1 == 4 ~"Will definitely not place an order"
                             ))

## Drinks

switchingData <- switchingData %>%
  mutate(switchAwayDrinks = case_when (Q16.2 == 1 ~"Highly likely to place an order",
                                     Q16.2 == 2 ~"Somewhat likely to place an order",
                                     Q16.2 == 3 ~"Unlikely to place an order",
                                     Q16.2 == 4 ~"Will definitely not place an order"
                             ))

## Snacks

switchingData <- switchingData %>%
  mutate(switchAwaySnacks = case_when (Q16.3 == 1 ~"Highly likely to place an order",
                                     Q16.3 == 2 ~"Somewhat likely to place an order",
                                     Q16.3 == 3 ~"Unlikely to place an order",
                                     Q16.3 == 4 ~"Will definitely not place an order"
                             ))

## Tobacco/Vapes

switchingData <- switchingData %>%
  mutate(switchAwaySmoking = case_when (Q16.4 == 1 ~"Highly likely to place an order",
                                     Q16.4 == 2 ~"Somewhat likely to place an order",
                                     Q16.4 == 3 ~"Unlikely to place an order",
                                     Q16.4 == 4 ~"Will definitely not place an order"
                             ))

## Urgent Needs

switchingData <- switchingData %>%
  mutate(switchAwayUrgent = case_when (Q16.5 == 1 ~"Highly likely to place an order",
                                     Q16.5 == 2 ~"Somewhat likely to place an order",
                                     Q16.5 == 3 ~"Unlikely to place an order",
                                     Q16.5 == 4 ~"Will definitely not place an order"
                            ))

## Customer Profile Questions

switchingData <- switchingData %>%
  mutate(AgeGroup = case_when(Q19 == 1 ~ "16-21",
                         Q19 == 2 ~ "22-24",
                         Q19 == 3 ~ "25-29",
                         Q19 == 4 ~ "30-34",
                         Q19 == 5 ~ "35-44",
                         Q19 == 6 ~ "45-54",
                         Q19 == 7 ~ "55-64",
                         Q19 == 8 ~ "65-74",
                         Q19 == 9 ~ "75+",
                         Q19 == 10 ~ "Prefer not to Say"))

switchingData <- switchingData %>%
  mutate(OccupationGroup = case_when(Q21 == 1 ~ "Full Time Employed",
                         Q21 == 2 ~ "Part Time Employed",
                         Q21 == 3 ~ "Self Employed",
                         Q21 == 4 ~ "Unemployed",
                         Q21 == 5 ~ "Student",
                         Q21 == 6 ~ "Pensioner",
                         Q21 == 7 ~ "Prefer not to Say"
                         )) %>%
  mutate(OccupationGroup = fct_reorder(OccupationGroup, Q21))

switchingData <- switchingData %>%
  mutate(EthnicGroup = case_when(Q20 == 1 ~ "White - English / Welsh / Scottish / Northern Irish / British",
                                 Q20 == 2 ~ "White - Irish",
                                 Q20 == 3 ~ "White - Gypsy or Irish Traveller",
                                 Q20 == 4 ~ "White - Any other",
                                 Q20 == 5 ~ "Mixed / Multiple ethnic groups - White and Black Caribbean",
                                 Q20 == 6 ~ "Mixed / Multiple ethnic groups - White and Black African",
                                 Q20 == 7 ~ "Mixed / Multiple ethnic groups - White and Asian",
                                 Q20 == 8 ~ "Mixed / Multiple ethnic groups - Any other",
                                 Q20 == 9 ~ "Asian / Asian British - Indian",
                                 Q20 == 10 ~ "Asian / Asian British - Pakistani",
                                 Q20 == 11 ~ "Asian / Asian British - Bangladeshi",
                                 Q20 == 12 ~ "Asian / Asian British - Chinese",
                                 Q20 == 13 ~ "Asian / Asian British - Any other Asian background",
                                 Q20 == 14 ~ "Black / African / Caribbean / Black British - African",
                                 Q20 == 15 ~ "Black / African / Caribbean / Black British - Caribbean",
                                 Q20 == 16 ~ "Black / African / Caribbean / Black British - Any other",
                                 Q20 == 17 ~ "Other Ethnic Group - Arab",
                                 Q20 == 18 ~ "Other Ethnic Group - Any other",
                                 Q20 == 19 ~ "Prefer not to say"
                         
                                 ))

```


# SWITCHING DATA

Include data like:
- How many customers did we start the month with on the database
- How many customers did we end the month with on the database
- Showing the net movement.

- Then say how many new customers, reactivated, increased loyalty etc etc
- Could also include some profiling of key attributes as well
- But mainly data from the loyalty dash
- And could possibly link off to that in the report.


```{r}
#| label: Number Responses

# Count how many responses.

completedResponses <-switchingData %>%
  filter(reportPeriod == reportMonth) %>%
  summarise(n=n())

completedResponsesValue <- completedResponses[[1]]

```

# RESEARCH RESPONSES

In the latest month of data collection we had `r completedResponsesValue` completed responses.

The share of customer self-evaluated changing loyalty levels in the latest month are as follows:

```{r}
#| label: Loyalty Change

switchingData %>%
  filter(reportPeriod == reportMonth) %>%
  group_by(loyaltyChange) %>%
  summarise(n=n()) %>%
  mutate(freq = round(n/sum(n),3)) %>%
  mutate(perc = percent(freq,accuracy = 0.1)) %>%
  select(-freq)

```


## CUSTOMERS INCREASING THEIR LOYALTY TO GOPUFF

### Awareness

For customers that made their first transaction with Gopuff in the last month, where did they originally hear about Gopuff?

```{r}
#| label: Awareness

aw1 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q2.1 == 1) %>%
  group_by(Q2.1) %>% summarise(n=n()) %>% mutate(Response = "Through a friend or family member")%>%
  select(Response, n)

aw2 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q2.2 == 1) %>%
  group_by(Q2.2) %>% summarise(n=n()) %>% mutate(Response = "Through social media")%>%
  select(Response, n)

aw3 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q2.3 == 1) %>%
  group_by(Q2.3) %>% summarise(n=n()) %>% mutate(Response = "Online or offline press/blogs etc.")%>%
  select(Response, n)

aw4 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q2.4 == 1) %>%
  group_by(Q2.4) %>% summarise(n=n()) %>% mutate(Response = "Leaflet")%>%
  select(Response, n)

aw5 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q2.5 == 1) %>%
  group_by(Q2.5) %>% summarise(n=n()) %>% mutate(Response = "I saw one of your riders on the street")%>%
  select(Response, n)

aw6 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q2.6 == 1) %>%
  group_by(Q2.6) %>% summarise(n=n()) %>% mutate(Response = "Uber Eats / Deliveroo")%>%
  select(Response, n)

aw7 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q2.7 == 1) %>%
  group_by(Q2.7) %>% summarise(n=n()) %>% mutate(Response = "Search Engine")%>%
  select(Response, n)

aw8 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q2.8 == 1) %>%
  group_by(Q2.8) %>% summarise(n=n()) %>% mutate(Response = "On the side of a bus or taxi.")%>%
  select(Response, n)

aw9 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q2.9 == 1) %>%
  group_by(Q2.9) %>% summarise(n=n()) %>% mutate(Response = "On the Tube / Underground")%>%
  select(Response, n)

aw10 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q2.10 == 1) %>%
  group_by(Q2.10) %>% summarise(n=n()) %>% mutate(Response = "Outdoor billboards / posters / bus stops etc.")%>%
  select(Response, n)

aw11 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q2.11 == 1) %>%
  group_by(Q2.11) %>% summarise(n=n()) %>% mutate(Response = "Other")%>%
  select(Response, n)

totalResponses <- switchingData %>%
  filter(reportPeriod == reportMonth, Q1 == 1) %>%
  summarise(total=n())

dataAwarenessTable <- rbind(aw1, aw2, aw3, aw4, aw5, aw6, aw7, aw8, aw9, aw10, aw11) 

# Create fake column to allow to cross join
totalResponses$x <- 1
dataAwarenessTable$x <- 1

dataAwarenessTable %>%
  full_join(totalResponses, by = "x") %>%
  select(-x) %>%
  arrange(desc(n)) %>%
  mutate(freq = round(n/total,3)) %>%
  mutate(perc = percent(freq, accuracy = 0.1)) %>%
  select(-freq, - total)
```

<br>
<br>
Responses for people that stated 'Other':
<br>
<br>

```{r}
#| label: Awareness other responses

switchingData %>%
  filter(reportPeriod == reportMonth) %>%
  select (Q3) %>%
  filter(Q3 != "N/A")
```


### Where are customers switching their spend from?

For customers increasing in loyalty (New to Gopuff, Recently Reactivated or Increasing their Spend vs the Previous Month), these are the retailers customers are switching from:

```{r}
#| label: Shop Less Retailers

switchingData %>%
  filter(reportPeriod == reportMonth, Q1 %in% c(1,2,3)) %>%
  group_by(shopLess) %>%
  summarise(n=n()) %>%
  mutate(freq = round(n/sum(n),3)) %>%
  mutate(perc = percent(freq,accuracy = 0.1)) %>%
  select(-freq) %>%
  arrange(desc(n))

```
<br>
<br>
Responses for people that stated 'Other':
<br>
<br>
```{r}
#| label: Shop less other responses

switchingData %>%
  filter(reportPeriod == reportMonth) %>%
  select (Q5) %>%
  filter(Q5 != "N/A")
```

### Why did they choose to switch more of their spend to Gopuff?

Open ended answers:

Cohort 1 (New): "I Made my First Transaction with Gopuff in the Last Month"

```{r}
#| label: Shop less - open ended reasons - New

switchingData %>%
  filter(reportPeriod == reportMonth, Q1 == 1) %>%
  select (Q6) %>%
  filter(Q6 != "N/A")
```

Cohort 2 (Reactivated): "I ordered from Gopuff in the last month, after having previously not shopped with Gopuff for a while."

```{r}
#| label: Shop less - open ended reasons - Reactivated

switchingData %>%
  filter(reportPeriod == reportMonth, Q1 == 2) %>%
  select (Q6) %>%
  filter(Q6 != "N/A")
```

Cohort 3 (Increasing Loyalty): "I regularly shop with Gopuff, and ordered more than usual in the last month."

```{r}
#| label: Shop less - open ended reasons - Increased loyalty

switchingData %>%
  filter(reportPeriod == reportMonth, Q1 == 3) %>%
  select (Q6) %>%
  filter(Q6 != "N/A")
```

And when we asked customers to pick from a list (with the option of picking multiple reasons), these were the top reasons for why they chose to switch to spending more with Gopuff:

```{r}
#| label: Shop More with Gopuff - Quantified Reasons

sm1 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.1 == 1) %>%
  group_by(Q7.1) %>% summarise(n=n()) %>% mutate(Response = "Gopuff’s product prices were cheaper")%>%
  select(Response, n)

sm2 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.2 == 1) %>%
  group_by(Q7.2) %>% summarise(n=n()) %>% mutate(Response = "Gopuff had better product discounts")%>%
  select(Response, n)

sm3 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.3 == 1) %>%
  group_by(Q7.3) %>% summarise(n=n()) %>% mutate(Response = "Gopuff had better money off coupons")%>%
  select(Response, n)

sm4 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.4 == 1) %>%
  group_by(Q7.4) %>% summarise(n=n()) %>% mutate(Response = "Gopuff had a better range of products to choose from")%>%
  select(Response, n)

sm5 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.5 == 1) %>%
  group_by(Q7.5) %>% summarise(n=n()) %>% mutate(Response = "Gopuff had better in-stock product availability")%>%
  select(Response, n)

sm6 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.6 == 1) %>%
  group_by(Q7.6) %>% summarise(n=n()) %>% mutate(Response = "Gopuff had lower fees, such as delivery fees")%>%
  select(Response, n)

sm7 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.7 == 1) %>%
  group_by(Q7.7) %>% summarise(n=n()) %>% mutate(Response = "Gopuff had a better loyalty scheme with Puff Points")%>%
  select(Response, n)

sm8 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.8 == 1) %>%
  group_by(Q7.8) %>% summarise(n=n()) %>% mutate(Response = "Gopuff has a better subscription service with Fam")%>%
  select(Response, n)

sm9 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.9 == 1) %>%
  group_by(Q7.9) %>% summarise(n=n()) %>% mutate(Response = "Gopuff had better delivery drivers")%>%
  select(Response, n)

sm10 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.10 == 1) %>%
  group_by(Q7.10) %>% summarise(n=n()) %>% mutate(Response = "Gopuff had a better app")%>%
  select(Response, n)

sm11 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.11 == 1) %>%
  group_by(Q7.11) %>% summarise(n=n()) %>% mutate(Response = "Gopuff offered quicker delivery")%>%
  select(Response, n)

sm12 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.12 == 1) %>%
  group_by(Q7.12) %>% summarise(n=n()) %>% mutate(Response = "I moved into / back into a Gopuff Delivery Zone")%>%
  select(Response, n)

sm13 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.13 == 1) %>%
  group_by(Q7.13) %>% summarise(n=n()) %>% mutate(Response = "Other")%>%
  select(Response, n)

totalSwitchingMoreResponses <- switchingData %>%
  filter(reportPeriod == reportMonth, Q1 %in% c(1,2,3)) %>%
  summarise(total=n())

dataSwitchingMoreReasonsTable <- rbind(sm1, sm2, sm3, sm4, sm5, sm6, sm7, sm8, sm9, sm10, sm11, sm12, sm13) 

# Create fake column to allow to cross join
totalSwitchingMoreResponses$x <- 1
dataSwitchingMoreReasonsTable$x <- 1

dataSwitchingMoreReasonsTable %>%
  full_join(totalSwitchingMoreResponses, by = "x") %>%
  select(-x) %>%
  arrange(desc(n)) %>%
  mutate(freq = round(n/total,3)) %>%
  mutate(perc = percent(freq, accuracy = 0.1)) %>%
  select(-freq, - total)
```


And just filtered to customers who switched from Getir, Gorillas and Zapp:

```{r}
#| label: Shop More with Gopuff - Quantified Reasons - just qcomm

sm1 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.1 == 1, Q4 %in% c(4,5,17)) %>%
  group_by(Q7.1) %>% summarise(n=n()) %>% mutate(Response = "Gopuff’s product prices were cheaper")%>%
  select(Response, n)

sm2 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.2 == 1, Q4 %in% c(4,5,17)) %>%
  group_by(Q7.2) %>% summarise(n=n()) %>% mutate(Response = "Gopuff had better product discounts")%>%
  select(Response, n)

sm3 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.3 == 1, Q4 %in% c(4,5,17)) %>%
  group_by(Q7.3) %>% summarise(n=n()) %>% mutate(Response = "Gopuff had better money off coupons")%>%
  select(Response, n)

sm4 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.4 == 1, Q4 %in% c(4,5,17)) %>%
  group_by(Q7.4) %>% summarise(n=n()) %>% mutate(Response = "Gopuff had a better range of products to choose from")%>%
  select(Response, n)

sm5 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.5 == 1, Q4 %in% c(4,5,17)) %>%
  group_by(Q7.5) %>% summarise(n=n()) %>% mutate(Response = "Gopuff had better in-stock product availability")%>%
  select(Response, n)

sm6 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.6 == 1, Q4 %in% c(4,5,17)) %>%
  group_by(Q7.6) %>% summarise(n=n()) %>% mutate(Response = "Gopuff had lower fees, such as delivery fees")%>%
  select(Response, n)

sm7 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.7 == 1, Q4 %in% c(4,5,17)) %>%
  group_by(Q7.7) %>% summarise(n=n()) %>% mutate(Response = "Gopuff had a better loyalty scheme with Puff Points")%>%
  select(Response, n)

sm8 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.8 == 1, Q4 %in% c(4,5,17)) %>%
  group_by(Q7.8) %>% summarise(n=n()) %>% mutate(Response = "Gopuff has a better subscription service with Fam")%>%
  select(Response, n)

sm9 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.9 == 1, Q4 %in% c(4,5,17)) %>%
  group_by(Q7.9) %>% summarise(n=n()) %>% mutate(Response = "Gopuff had better delivery drivers")%>%
  select(Response, n)

sm10 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.10 == 1, Q4 %in% c(4,5,17)) %>%
  group_by(Q7.10) %>% summarise(n=n()) %>% mutate(Response = "Gopuff had a better app")%>%
  select(Response, n)

sm11 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.11 == 1, Q4 %in% c(4,5,17)) %>%
  group_by(Q7.11) %>% summarise(n=n()) %>% mutate(Response = "Gopuff offered quicker delivery")%>%
  select(Response, n)

sm12 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.12 == 1, Q4 %in% c(4,5,17)) %>%
  group_by(Q7.12) %>% summarise(n=n()) %>% mutate(Response = "I moved into / back into a Gopuff Delivery Zone")%>%
  select(Response, n)

sm13 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q7.13 == 1, Q4 %in% c(4,5,17)) %>%
  group_by(Q7.13) %>% summarise(n=n()) %>% mutate(Response = "Other")%>%
  select(Response, n)

totalSwitchingMoreResponses <- switchingData %>%
  filter(reportPeriod == reportMonth, Q1 %in% c(1,2,3),  Q4 %in% c(4,5,17)) %>%
  summarise(total=n())

dataSwitchingMoreReasonsTable <- rbind(sm1, sm2, sm3, sm4, sm5, sm6, sm7, sm8, sm9, sm10, sm11, sm12, sm13) 

# Create fake column to allow to cross join
totalSwitchingMoreResponses$x <- 1
dataSwitchingMoreReasonsTable$x <- 1

dataSwitchingMoreReasonsTable %>%
  full_join(totalSwitchingMoreResponses, by = "x") %>%
  select(-x) %>%
  arrange(desc(n)) %>%
  mutate(freq = round(n/total,3)) %>%
  mutate(perc = percent(freq, accuracy = 0.1)) %>%
  select(-freq, - total)
```

### Which orders did they place with Gopuff in the last month:

```{r}
#| label: Shop More with Gopuff - Which orders

smo1 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q8.1 == 1) %>%
  group_by(Q8.1) %>% summarise(n=n()) %>% mutate(Response = "Day to Day Grocery Orders")%>%
  select(Response, n)

smo2 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q8.2 == 1) %>%
  group_by(Q8.2) %>% summarise(n=n()) %>% mutate(Response = "Drinks Orders")%>%
  select(Response, n)

smo3 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q8.3 == 1) %>%
  group_by(Q8.3) %>% summarise(n=n()) %>% mutate(Response = "Snacks Orders")%>%
  select(Response, n)

smo4 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q8.4 == 1) %>%
  group_by(Q8.4) %>% summarise(n=n()) %>% mutate(Response = "Smoking Orders")%>%
  select(Response, n)

smo5 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q8.5 == 1) %>%
  group_by(Q8.5) %>% summarise(n=n()) %>% mutate(Response = "Urgent Needs Orders")%>%
  select(Response, n)

totalSwitchingMoreResponses <- switchingData %>%
  filter(reportPeriod == reportMonth, Q1 %in% c(1,2,3)) %>%
  summarise(total=n())

dataSwitchingMoreOrderTypeTable <- rbind(smo1, smo2, smo3, smo4, smo5) 

# Create fake column to allow to cross join
totalSwitchingMoreResponses$x <- 1
dataSwitchingMoreOrderTypeTable$x <- 1

dataSwitchingMoreOrderTypeTable %>%
  full_join(totalSwitchingMoreResponses, by = "x") %>%
  select(-x) %>%
  arrange(desc(n)) %>%
  mutate(freq = round(n/total,3)) %>%
  mutate(perc = percent(freq, accuracy = 0.1)) %>%
  select(-freq, - total)
```

And just filtered to customers who switched from Getir, Gorillas and Zapp:

```{r}
#| label: Shop More with Gopuff - Which orders - just qcomm

smo1 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q8.1 == 1, Q4 %in% c(4,5,17)) %>%
  group_by(Q8.1) %>% summarise(n=n()) %>% mutate(Response = "Day to Day Grocery Orders")%>%
  select(Response, n)

smo2 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q8.2 == 1, Q4 %in% c(4,5,17)) %>%
  group_by(Q8.2) %>% summarise(n=n()) %>% mutate(Response = "Drinks Orders")%>%
  select(Response, n)

smo3 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q8.3 == 1, Q4 %in% c(4,5,17)) %>%
  group_by(Q8.3) %>% summarise(n=n()) %>% mutate(Response = "Snacks Orders")%>%
  select(Response, n)

smo4 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q8.4 == 1, Q4 %in% c(4,5,17)) %>%
  group_by(Q8.4) %>% summarise(n=n()) %>% mutate(Response = "Smoking Orders")%>%
  select(Response, n)

smo5 <- switchingData %>%
  filter(reportPeriod == reportMonth, Q8.5 == 1, Q4 %in% c(4,5,17)) %>%
  group_by(Q8.5) %>% summarise(n=n()) %>% mutate(Response = "Urgent Needs Orders")%>%
  select(Response, n)

totalSwitchingMoreResponses <- switchingData %>%
  filter(reportPeriod == reportMonth, Q1 %in% c(1,2,3), Q4 %in% c(4,5,17)) %>%
  summarise(total=n())

dataSwitchingMoreOrderTypeTable <- rbind(smo1, smo2, smo3, smo4, smo5) 

# Create fake column to allow to cross join
totalSwitchingMoreResponses$x <- 1
dataSwitchingMoreOrderTypeTable$x <- 1

dataSwitchingMoreOrderTypeTable %>%
  full_join(totalSwitchingMoreResponses, by = "x") %>%
  select(-x) %>%
  arrange(desc(n)) %>%
  mutate(freq = round(n/total,3)) %>%
  mutate(perc = percent(freq, accuracy = 0.1)) %>%
  select(-freq, - total)
```

